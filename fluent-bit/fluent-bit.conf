[SERVICE]
    Flush             1
    Daemon            Off
    Log_Level         info
    HTTP_Server       On
    HTTP_Listen       0.0.0.0
    HTTP_Port         2020
    Parsers_File      /fluent-bit/etc/parsers.conf

[INPUT]
    Name              http
    Listen            0.0.0.0
    Port              24224
    Tag               app

[FILTER]
    Name              parser
    Match             app
    Key_Name          data
    Parser            json
    Reserve_Data      On

# Add this filter to preserve the original level from your logger
[FILTER]
    Name              modify
    Match             app
    Rename            level loglevel

# Add this to rewrite tags based on log level
[FILTER]
    Name                  rewrite_tag
    Match                 app
    Rule                  $loglevel ^(info)$ app.info true
    Rule                  $loglevel ^(warn|warning)$ app.warn true
    Rule                  $loglevel ^(error|err|critical)$ app.error true
    Emitter_Name          re_emitted
    Emitter_Storage.type  filesystem
    Emitter_Mem_Buf_Limit 10M

[OUTPUT]
    Name              file
    Match             app.*
    Path              /tmp
    File              fluent_all.log
    Mkdir             On

[OUTPUT]
    Name              file
    Match             app.error
    Path              ${LOG_DIR}
    File              fluent_error.log
    Mkdir             On

[OUTPUT]
    Name              file
    Match             app.info
    Path              ${LOG_DIR}
    File              fluent_info.log
    Mkdir             On

[OUTPUT]
    Name              file
    Match             app.warn
    Path              ${LOG_DIR}
    File              fluent_warn.log
    Mkdir             On